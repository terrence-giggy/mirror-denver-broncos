# Workflow to assign document parsing and extraction work to GitHub Copilot.
# 
# Triggered when an issue is labeled with 'parse-and-extract'.
# This workflow assigns the issue to GitHub Copilot which will:
# 1. Parse the document from the source URL/path specified in the issue
# 2. Extract person names using AI
# 3. Save extracted people to the knowledge graph
# 4. Create a branch with the changes and open a PR
#
# To use: Create an issue using the 'Parse and Extract Document' template
# or manually add the 'parse-and-extract' label to any issue with a
# document source specified.

name: "Content: Parse & Extract Entities"

on:
  issues:
    types: [labeled]

permissions:
  issues: write
  contents: read

jobs:
  parse-and-extract:
    if: github.event.label.name == 'parse-and-extract'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Run Parse and Extract Mission
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
          COPILOT_TOKEN: ${{ secrets.COPILOT_TOKEN }}
        run: |
          python -m main agent run \
            --mission parse_and_extract \
            --input issue_number=${{ github.event.issue.number }} \
            --input repository=${{ github.repository }}
