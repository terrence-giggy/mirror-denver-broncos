# Mission to monitor registered sources for content changes.

id: monitor_sources
version: 1
metadata:
  owner: copilot-orchestrator
  created_at: 2025-12-26
  summary_tooling: source-monitoring

goal: |
  Monitor registered sources and queue them for acquisition when needed.
  
  IMPORTANT: This mission ONLY processes sources with status="active". Sources in
  "pending_review" status must be approved first (via Source Curator workflow) before
  they can be monitored. If no active sources exist, complete gracefully.
  
  This mission handles TWO distinct modes:
  
  MODE 1 - Initial Acquisition (last_content_hash is None):
  - Source has status="active" but was never acquired
  - Skip change detection (nothing to compare)
  - Call `create_initial_acquisition_issue` tool with the source URL
  - Acquisition Agent will set last_content_hash after completion
  
  MODE 2 - Update Monitoring (last_content_hash exists):
  - Source has been previously acquired
  - Perform tiered change detection:
    * Tier 1: Compare HTTP ETag header
    * Tier 2: Compare Last-Modified header  
    * Tier 3: Compare content hash (only if tiers 1-2 indicate change)
  - If changed, call `create_content_update_issue` tool
  
  Workflow steps:
  1. Call `get_sources_pending_initial` to find active sources needing initial acquisition
  2. For each source returned, call `create_initial_acquisition_issue` with the source URL
  3. Call `get_sources_due_for_check` to find active sources due for update monitoring
  4. For each source returned, call `check_source_for_changes` to detect updates
  5. If changes detected, call `create_content_update_issue` with detection details
  6. Call `update_source_monitoring_metadata` to record check timestamps
  7. If a source has 5+ consecutive failures, call `report_source_access_problem`
  
  This mission runs on schedule via GitHub Actions (every 6 hours).

constraints:
  - "Only process sources with status='active' - skip pending_review sources"
  - "For initial acquisition: call create_initial_acquisition_issue tool (do not just document)"
  - "For updates: call create_content_update_issue tool when changes are detected"
  - "For updates: use HEAD requests first to minimize bandwidth"
  - "Respect rate limits: minimum 1 second between requests to same domain"
  - "Do not fetch full content unless change is detected (update mode only)"
  - "Do not create duplicate Issues - check markers before creation"
  - "Update source metadata even when no change detected (last_checked)"
  - "Maximum 5 consecutive failures before marking source degraded"
  - "Primary sources get high priority, reference sources get low priority"
  - "If no active sources found, complete mission successfully with no actions"

success_criteria:
  - Sources needing initial acquisition have `initial-acquisition` Issues
  - Changed sources have `content-update` Issues created
  - No duplicate Issues created for same content version
  - Source monitoring metadata updated in registry
  - Access problems reported for sources with 5+ failures

max_steps: 50
allowed_tools:
  # Read tools
  - list_sources
  - get_source
  - get_sources_pending_initial
  - get_sources_due_for_check
  - check_source_for_changes
  - verify_source_accessibility
  
  # Write tools
  - update_source_monitoring_metadata
  - create_initial_acquisition_issue
  - create_content_update_issue
  - report_source_access_problem
  - update_source_status

requires_approval: false
